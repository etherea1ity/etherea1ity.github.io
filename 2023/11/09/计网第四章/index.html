<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>计网第四章 | Jerryの魔法小屋</title><meta name="author" content="Jerry Jiang"><meta name="copyright" content="Jerry Jiang"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="[toc] 第四章 网络层重要内容 虚拟互联网的概念 IP地址与物理地址的关系 传统的分类的IP地址（包括子网掩码）和无分类域间路由选择 路由选择协议的工作方式  核心知识点网络层几个概念网络层提供的两种服务 网络层面向无连接，不负责提供可靠的服务。将确保数据可靠的任务交给了上层的运输层（TCP协议）。  电信网是面向连接的通信方式，建立虚电路（virtual circuit），且有可靠的网络层协">
<meta property="og:type" content="article">
<meta property="og:title" content="计网第四章">
<meta property="og:url" content="http://example.com/2023/11/09/%E8%AE%A1%E7%BD%91%E7%AC%AC%E5%9B%9B%E7%AB%A0/index.html">
<meta property="og:site_name" content="Jerryの魔法小屋">
<meta property="og:description" content="[toc] 第四章 网络层重要内容 虚拟互联网的概念 IP地址与物理地址的关系 传统的分类的IP地址（包括子网掩码）和无分类域间路由选择 路由选择协议的工作方式  核心知识点网络层几个概念网络层提供的两种服务 网络层面向无连接，不负责提供可靠的服务。将确保数据可靠的任务交给了上层的运输层（TCP协议）。  电信网是面向连接的通信方式，建立虚电路（virtual circuit），且有可靠的网络层协">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://imageurlbed.oss-cn-shenzhen.aliyuncs.com/img/mountains-7750722_1920.jpg">
<meta property="article:published_time" content="2023-11-09T12:05:34.000Z">
<meta property="article:modified_time" content="2023-11-17T09:27:13.794Z">
<meta property="article:author" content="Jerry Jiang">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://imageurlbed.oss-cn-shenzhen.aliyuncs.com/img/mountains-7750722_1920.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2023/11/09/%E8%AE%A1%E7%BD%91%E7%AC%AC%E5%9B%9B%E7%AB%A0/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '计网第四章',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-11-17 17:27:13'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><script src="/live2d-widget/autoload.js"></script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://imageurlbed.oss-cn-shenzhen.aliyuncs.com/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">15</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://imageurlbed.oss-cn-shenzhen.aliyuncs.com/img/mountains-7750722_1920.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="Jerryの魔法小屋"><span class="site-name">Jerryの魔法小屋</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">计网第四章</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-11-09T12:05:34.000Z" title="发表于 2023-11-09 20:05:34">2023-11-09</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-11-17T09:27:13.794Z" title="更新于 2023-11-17 17:27:13">2023-11-17</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/">计算机科学</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">计算机网络</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="计网第四章"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>[toc]</p>
<h1 id="第四章-网络层"><a href="#第四章-网络层" class="headerlink" title="第四章 网络层"></a>第四章 网络层</h1><h2 id="重要内容"><a href="#重要内容" class="headerlink" title="重要内容"></a>重要内容</h2><ul>
<li><strong>虚拟互联网</strong>的概念</li>
<li><strong>IP地址与物理地址</strong>的关系</li>
<li>传统的分类的IP地址（包括子网掩码）和无分类域间路由选择</li>
<li><strong>路由选择协议</strong>的工作方式</li>
</ul>
<h2 id="核心知识点"><a href="#核心知识点" class="headerlink" title="核心知识点"></a>核心知识点</h2><h3 id="网络层几个概念"><a href="#网络层几个概念" class="headerlink" title="网络层几个概念"></a>网络层几个概念</h3><h4 id="网络层提供的两种服务"><a href="#网络层提供的两种服务" class="headerlink" title="网络层提供的两种服务"></a>网络层提供的两种服务</h4><ol>
<li><p>网络层<strong>面向无连接，不负责提供可靠的服务</strong>。将确保数据可靠的任务交给了上层的<strong>运输层（TCP协议</strong>）。</p>
</li>
<li><p>电信网是<strong>面向连接</strong>的通信方式，建立<strong>虚电路（virtual circuit）</strong>，且有可靠的网络层协议。</p>
</li>
<li><p>网络层向上只提供<strong>简单灵活的、无连接的、尽最大努力交付的</strong>数据报服务。不提供<strong>服务质量的承诺</strong>，使路由器比较简单。</p>
<ol>
<li>原因：计算机网络的端系统是<strong>具有智能的计算机</strong>，具有很强的<strong>差错处理能力</strong>。而传统电信网络的端系统是电话机，没有差错处理能力，所以要将确保可靠的任务交给网络层。</li>
<li>优点：<strong>网络造价大大降低，运行方式灵活，能够适应多种应用。</strong></li>
</ol>
</li>
</ol>
<p>   <img src="https://imageurlbed.oss-cn-shenzhen.aliyuncs.com/img/virtualanddata.png" alt="服务对比"></p>
<ol>
<li>虚电路服务</li>
</ol>
<p><img src="https://imageurlbed.oss-cn-shenzhen.aliyuncs.com/img/datagram.png" alt=""></p>
<h4 id="网络层的两个层面"><a href="#网络层的两个层面" class="headerlink" title="网络层的两个层面"></a>网络层的两个层面</h4><ol>
<li>不同网络之间的两个主机通信经过若干<strong>路由器转发分组</strong>完成，分组查找路由器中的<strong>转发表</strong>，转发表通过<strong>路由表</strong>导出。</li>
<li>路由器之间传送的信息分为两大类<ol>
<li><strong>转发源主机和目的主机之间所传送的数据</strong></li>
<li><strong>传送路由信息</strong>，这一类是为上面一类数据的传送服务的，目的是为了在<strong>路由器中创建路由表，由此导出转发分组而用的转发表</strong>。</li>
</ol>
</li>
<li>把网络层抽象地划分为<strong>数据层面（转发层面）</strong>和<strong>控制层面</strong>，这里的层面是plane，像体系结构中的layer。</li>
</ol>
<p><img src="https://imageurlbed.oss-cn-shenzhen.aliyuncs.com/img/planecontrol.png" alt=""></p>
<ol>
<li>数据层面的问题比较单纯，因为路由器转发分组是<strong>独立地</strong>根据本路由器的转发表转发分组的。</li>
<li>控制层面比较复杂，因为路由器要创建路由表，需要多个路由器<strong>协同工作</strong>。</li>
</ol>
<p><img src="https://imageurlbed.oss-cn-shenzhen.aliyuncs.com/img/datacontrol.png" alt=""></p>
<ol>
<li><strong>软件定义网络SDN</strong>：在网络控制层面有一个逻辑上集中的<strong>远程控制器</strong>，能够为每一个分组计算出最佳的路由，再在每一个路由器中生成其正确的转发表。</li>
</ol>
<p><img src="https://imageurlbed.oss-cn-shenzhen.aliyuncs.com/img/SDN.png" alt=""></p>
<h3 id="网际IP"><a href="#网际IP" class="headerlink" title="网际IP"></a>网际IP</h3><ol>
<li>主要协议<ol>
<li><strong>网际协议IP（Internet Protocol）</strong>：Robert Kahn和Vint Cerf共同研发。</li>
<li><strong>地址解析协议ARP（Address Resolvotion Protocol）</strong>。</li>
<li><strong>网际控制报文协议ICMP（Internet Control Message Protocol）</strong>。</li>
<li><strong>网际组管理协议IGMP（Internet Group Management Protocol）</strong>。</li>
</ol>
</li>
</ol>
<p><img src="https://imageurlbed.oss-cn-shenzhen.aliyuncs.com/img/IPnetwork.png" alt=""></p>
<h4 id="虚拟互联网络"><a href="#虚拟互联网络" class="headerlink" title="虚拟互联网络"></a>虚拟互联网络</h4><ol>
<li>网络互联的一些中间设备：<ol>
<li><strong>物理层：转发器（repeater）</strong></li>
<li><strong>数据链路层：网桥或桥接器，以及交换机</strong></li>
<li><strong>网络层：路由器（连接局域网）</strong></li>
<li><strong>网络层以上：网关</strong></li>
</ol>
</li>
<li>即逻辑互联网络,<strong>忽略物理层的客观异构性,在网络层看起来好像是一个统一的网络</strong>,即互联网可以有多种异构的网络组成。（就像操作系统的逻辑设备一样，屏蔽差异）如果在这种覆盖全球的 IP 网的上层使用 TCP 协议，那么就是现在的<strong>互联网 Internet。</strong></li>
</ol>
<p><img src="https://imageurlbed.oss-cn-shenzhen.aliyuncs.com/img/ipnet.png" alt=""></p>
<ol>
<li>交付给路由器为<strong>间接交付</strong>，交给目的主机为<strong>直接交付</strong>。注意，互联网可以由多种异构网络互联而成，其中分组在传送途中的每一次转发被称为<strong>一跳（hop）</strong>。</li>
</ol>
<p><img src="https://imageurlbed.oss-cn-shenzhen.aliyuncs.com/img/hop.png" alt=""></p>
<h4 id="IP地址"><a href="#IP地址" class="headerlink" title="IP地址"></a>IP地址</h4><ol>
<li>IP地址是给互联网上<strong>每一个主机（或路由器）的每一个接口</strong>分配一个在全世界范围内是<strong>唯一</strong>的<strong>32位（IPV4）</strong>的标识符。（<strong>MAC地址对每个计算机是固定的，IP地址不固定</strong>）。IP 地址现在由<strong>互联网名字和数字分配机构ICANN</strong>进行分配。<strong>每台主机或者路由器可以有多个IP地址。</strong></li>
<li>IP地址指明了<strong>连接到某个网络上的一个主机</strong>。</li>
<li>常采用<strong>点分十进制</strong>记法，也就是32位IP中每8位插入一个空格。一般32位IP中，<strong>前n位为网络号，后32-n位为主机号</strong>。</li>
</ol>
<h5 id="分类的IP地址"><a href="#分类的IP地址" class="headerlink" title="分类的IP地址"></a>分类的IP地址</h5><ol>
<li>分类的IP地址，其中<strong>A（n=8），B（n=16），C（n=24）类</strong>为<strong>单播地址</strong>。D类是<strong>多播地址</strong>，E类是<strong>保留地址</strong>。</li>
<li>32位IP地址中有$2^{32}$个地址，A类有$2^{31}$个地址，占50%，B类$2^{30}$个地址，占25%，C类12.5%，D、E各6.25%。</li>
</ol>
<p><img src="https://imageurlbed.oss-cn-shenzhen.aliyuncs.com/img/ipclassify.png" alt=""></p>
<ol>
<li><p>A类地址网络号占用<strong>1个字节</strong>，因此<strong>只有7位可供使用</strong>，但是由于规定，<strong>网络字段全0是个保留字段表示本网络，而127（01111111）是另外一个保留字段，作为本地软件的环回测试。</strong>我们常见的127.0.0.1表示本机，原因也是出自这里。所以A类地址可以指派的<strong>网络号个数为$2^7-2$</strong>。</p>
</li>
<li><p>A类网络的主机号占<strong>3个字节</strong>，但全0和全1一般不指派。全0代表该IP地址是“本主机”所连接到的<strong>单个网络地址（如5.6.7.8的网络地址为5.0.0.0）</strong>。全1代表“所有的”，代表这个这个网络上的所有的主机。因此最大主机数为<strong>$2^{24}-2$</strong></p>
</li>
<li><p>B类网络地址网络号有<strong>两个字节</strong>，可指派的<strong>网络号个数为$2^{14}-1$</strong>，最大主机数为$2^{16}-2$</p>
</li>
<li><p>C类地址有<strong>3个字节</strong>的网络字段号，可指派的<strong>网络号个数为</strong>$2^{21}-1$<strong>，</strong>最大主机数为$2^{8}-2$**</p>
</li>
<li>A、B、C三类地址的主机号，<strong>全0或全1均有特殊作用</strong>，分别表示本主机和当前网络内全部主机，所以可用的主机号为<strong>$2^{n-1}$</strong>。</li>
</ol>
<p><img src="https://imageurlbed.oss-cn-shenzhen.aliyuncs.com/img/specialip.png" alt=""></p>
<h5 id="划分子网和构造超网"><a href="#划分子网和构造超网" class="headerlink" title="划分子网和构造超网"></a>划分子网和构造超网</h5><ol>
<li><p>从<strong>两级</strong> IP 地址<strong>（网络号+主机号）</strong>到<strong>三级</strong> IP 地址<strong>（网络号+子网号+主机号）</strong></p>
<ol>
<li><p>原因：在 ARPANET 的早期，IP 地址的设计确实不够合理：</p>
<ol>
<li>IP 地址空间的<strong>利用率有时很低</strong>。</li>
<li>给每一个物理网络分配一个网络号会<strong>使路由表变得太大</strong>因而使网络性能变坏</li>
<li>两级的 IP 地址<strong>不够灵活</strong></li>
</ol>
</li>
<li><p>从 1985 年起在 IP 地址中又增加了一个“子网号字段”，使两级的 IP 地址变成为三级的 IP 地址。</p>
</li>
</ol>
</li>
<li><p>B类网络遇到的问题</p>
<ol>
<li>碰撞域太大，性能降低</li>
<li>站表太长（记录每一个站地址和接口的表）</li>
</ol>
</li>
<li><p>划分子网纯属一个<strong>单位内部事务</strong>。单位对外仍然表现为没有划分子网的网络。<strong>子网对外部透明</strong>。外部主机只需要将IP数据报发送给该单位的网络，发送到具体的子网由该单位自己负责。</p>
</li>
<li><p>方法：<strong>从主机号借用若干个位作为子网号 subnet-id，而主机号 host-id 也就相应减少了若干个位</strong>。凡是从其他网络发送给本单位某个主机的 IP 数据报，仍然是根据 IP 数据报的<strong>目的网络号</strong> net-id，先找到连接在本单位网络上的路由器。然后<strong>该路由器</strong>在收到 IP 数据报后，再按目的网络号 net-id 和<strong>子网号</strong> subnet-id 找到目的子网。最后就将 IP 数据报直接交付目的主机。</p>
</li>
</ol>
<p><img src="https://imageurlbed.oss-cn-shenzhen.aliyuncs.com/img/huafenziwang.png" alt=""></p>
<ol>
<li><strong>子网掩码</strong>：存放在路由器中，路由器在与相邻路由器交换信息时，需要给出所在网络的子网掩码，路由表中每一个目的网络地址后面也需要给出该目的网络的子网掩码。<strong>包含了网络地址和子网地址共同的掩码</strong>。</li>
</ol>
<p><img src="https://imageurlbed.oss-cn-shenzhen.aliyuncs.com/img/subnetworkmask.png" alt="子网掩码"></p>
<ol>
<li>划分子网增加了灵活性，但却<strong>减少了能够连接在网络上的主机总数</strong>。（<strong>每个子网的主机号全0或全1均保留</strong>）</li>
</ol>
<h5 id="无分类编制CIDR"><a href="#无分类编制CIDR" class="headerlink" title="无分类编制CIDR"></a>无分类编制CIDR</h5><ol>
<li>CIDR（Classless Inter-Domain Routing，”sider”）</li>
<li>把前面分类的网络号改为<strong>网络前缀（network-prefix）</strong>，后面仍为<strong>主机号(后缀suffix)</strong>。这里网络前缀的n可以取<strong>任意的数</strong>。</li>
<li>使用<strong>斜线记法（slash notation）</strong>，斜线后面为<strong>网络前缀所占的个数</strong>，如128.14.35.7/20，则二进制IP地址网络前缀为前20位。</li>
<li><strong>地址块</strong>，CIDR把<strong>网络前缀相同的</strong>所有连续IP地址组成一个<strong>CIDR地址块</strong>。我们只要知道一个CIDR地址，就知道这个地址块中的最大和最小地址。如网络前缀20位的一个CIDR地址，<strong>可分配的地址有$2^{12}-2$个</strong>，其中除去了全0和全1地址。</li>
<li>我们无法只从slash左边知道网络地址，这一点分类网络方便一些。</li>
<li><strong>地址掩码（address mask）</strong>，又称<strong>子网掩码</strong>，由于计算机看不见斜线记法，所以使用掩码进行计算。掩码由一连串1和接着一连串0组成，<strong>1的个数表示网络前缀的长度</strong>。如/20地址块的地址掩码用CIDR记法就为255.255.240.0/20。</li>
<li>对于早期使用的分类IP地址，如A类掩码（地址掩码固定，常常不用专门指出）为255.0.0.0或255.0.0.0/8。</li>
<li>将2进制的IP地址和地址掩码进行<strong>按位AND运算</strong>，即可得出网络地址（也就是网络块最小的那个地址）。</li>
<li>CIDR三个特殊地址块：<ol>
<li>前缀n=32，是一个用于<strong>主机路由</strong>的特殊地址。</li>
<li>前缀n=31，只有两个IP地址，用于<strong>点对点链路</strong>。</li>
<li>前缀n=0，同时IP地址也全是0，用于<strong>默认路由</strong>。</li>
</ol>
</li>
<li><strong>路由聚合（route aggregation）</strong>，由于一个大的CIDR地址块包含了许多小的CIDR地址块，因此路由器中的转发表往往用一个项目就可以表示原先的很多个。</li>
<li><strong>构成超网</strong>，前缀长度不超过23位的CIDR地址块包含多个C类地址，这些C类地址合起来构成超网。CIDR地址块中的地址数一定时2的整数次幂。</li>
</ol>
<p><img src="https://imageurlbed.oss-cn-shenzhen.aliyuncs.com/img/CIDRaddresshuafen.png" alt=""></p>
<h5 id="IP地址特点"><a href="#IP地址特点" class="headerlink" title="IP地址特点"></a>IP地址特点</h5><ol>
<li>IP地址是分等级的地址结构，第一，IP地址管理机构分配IP地址只分配<strong>网络前缀（第一级）</strong>，主机号自行分配。第二，路由器仅<strong>根据目的主机所连接的网络前缀</strong>来转发分组（而不考虑目的主机号），这样就可以<strong>使路由表中的项目数大幅度减少，从而减小了路由表所占的存储空间</strong>。 </li>
<li><p>实际上 IP 地址是<strong>标志一个主机（或路由器）和一条链路的接口。</strong></p>
<ol>
<li><strong>多归属主机</strong>：当一个主机同时连接到两个网络上时，该主机就必须<strong>同时具有两个相应的 IP 地址</strong>，其网络号 net-id 必须是不同的。</li>
<li><strong>路由器</strong>：由于一个路由器<strong>至少应当连接到两个网络</strong>（这样它才能将 IP 数据报从一个网络转发到另一个网络），因此一个路由器<strong>至少应当有两个不同的 IP 地址</strong>。</li>
<li>同一个局域网上的主机或路由器的IP地址中<strong>网络前缀必须一样</strong>。</li>
</ol>
</li>
</ol>
<ol>
<li><p>用<strong>转发器（物理层）或网桥（数据链路层）</strong>连接起来的若干个局域网仍为一个网络，因此这些局域网都具有同样的网络号 net-id。（<strong>网络层的路由器才是连接不同网络的中继系统</strong>）前者仅仅是<strong>扩展局域网</strong>，后者是<strong>连通局域网</strong>。</p>
</li>
<li><p>所有分配到网络号 net-id 的网络，无论是范围很小的局域网，还是可能覆盖很大地理范围的广域网，都是<strong>平等的。</strong></p>
</li>
</ol>
<h4 id="IP地址与MAC地址"><a href="#IP地址与MAC地址" class="headerlink" title="IP地址与MAC地址"></a>IP地址与MAC地址</h4><ol>
<li>IP地址与硬件地址的区别：<ol>
<li><strong>硬件地址（或物理地址、MAC地址）</strong>是<strong>数据链路层和物理层</strong>使用的地址。而<strong>IP 地址</strong>是<strong>网络层和以上各层</strong>使用的地址，是一种<strong>逻辑地址</strong>（称 IP 地址是逻辑地址是因为 IP 地址是用软件实现的）</li>
<li><strong>IP 地址放在 IP 数据报的首部，而硬件地址则放在 MAC 帧的首部</strong>。当已知主机或路由器的IP地址后，需要通过<strong>ARP地址</strong>解析协议得出其MAC地址。</li>
<li><strong>IP层抽象的互联网上只能看到IP数据报</strong>，<strong>链路层只能看见MAC帧</strong>。</li>
<li>分组每次经过路由器转发时都要将MAC帧的首部和尾部丢弃重新封装——<strong>变换MAC帧中的目的MAC地址和源MAC地址。而IP数据报中的源IP地址和目的IP地址始终不变。</strong></li>
</ol>
</li>
</ol>
<p><img src="https://imageurlbed.oss-cn-shenzhen.aliyuncs.com/img/differIPMAC.png" alt=""></p>
<ol>
<li>IP数据报首部源地址和目的地址只有<strong>最初的起点终点</strong>，而MAC帧才包含<strong>途径的路由器等</strong>。</li>
</ol>
<p><img src="https://imageurlbed.oss-cn-shenzhen.aliyuncs.com/img/h1h2tongxin.png" alt=""></p>
<h4 id="地址解析协议ARP"><a href="#地址解析协议ARP" class="headerlink" title="地址解析协议ARP"></a>地址解析协议ARP</h4><ol>
<li>ARP 作用：<strong>从网络层使用的 IP 地址，解析出在数据链路层使用的硬件地址。</strong></li>
</ol>
<p><img src="https://imageurlbed.oss-cn-shenzhen.aliyuncs.com/img/ARPzuoyong.png" alt=""></p>
<ol>
<li><p><strong>ARP高速缓存</strong>：每一个主机都设有一个 <strong>ARP 高速缓存 ARP cache</strong>，里面有<strong>本局域网</strong>上的各主机和路由器的<strong>IP 地址到硬件地址MAC的映射表</strong>，条目为&lt; IP address；MAC address；TTL &gt;，其中<strong>TTL为生存时间（地址映射有效时间）</strong> 。ARP高速缓存动态更新。</p>
</li>
<li><p>ARP流程：</p>
<ol>
<li>当主机 A 欲向本局域网上的某个主机 B 发送 IP 数据报时，就先<strong>在其 ARP 高速缓存中查看有无主机 B 的 IP 地址</strong>。</li>
<li>如有，就可查出其对应的硬件地址，再将此硬件地址<strong>写入 MAC 帧，</strong>然后通过局域网将该 MAC 帧发往此硬件地址。</li>
<li>如没有， ARP 进程在本局域网上<strong>广播</strong>发送一个 <strong>ARP 请求分组</strong>。收到 <strong>ARP 响应分组（单播）</strong>后，将得到的 IP 地址到硬件地址的映射写入 <strong>ARP 高速缓存</strong>。并写入MAC帧进行发送。</li>
</ol>
</li>
<li><p>要点：</p>
<ol>
<li><strong>ARP请求分组</strong>：发送方硬件地址 / 发送方 IP 地址 / <strong>目标方硬件地址未知时填0，由接收方填写未知时填0，由接收方填写</strong> / 目标方 IP 地址。</li>
<li><strong>本地广播ARP请求</strong>，也就是<strong>路由器不转发ARP请求</strong>。</li>
<li><strong>ARP 响应分组</strong>：发送方硬件地址 / 发送方 IP地址 / 目标方硬件地址 / 目标方 IP 地址。</li>
<li>ARP 分组封装在物理网络的<strong>帧</strong>中传输。</li>
<li>本地广播 ARP 请求（<strong>路由器不转发ARP请求</strong>）。<strong>ARP 是解决同一个局域网上的主机或路由器的 IP 地址和硬件地址的映射问题</strong>。一个主机想解析出另一个局域网上主机的MAC地址，需要先通过ARP找到当前局域网的一个<strong>路由器</strong>的MAC地址并发送，再通过它的转发表层层进行ARP操作并转发，直到找到目的主机所在的网络的一个路由器，由它广播ARP请求分组，获取目的主机的硬件地址。</li>
<li>从硬件地址到IP地址的解析每次转发分组时都要重复进行，但这种开销是不可避免的，是为<strong>方便的在各种异构网络之间进行转发工作而屏蔽网络硬件之间的异构性</strong>，从而体现出虚拟网络的含义。</li>
<li>为什么不统一使用硬件地址进行通信？<strong>由于全世界存在着各式各样的网络，它们使用不同的硬件地址。</strong>要使这些异构网络能够互相通信就必须进行非常复杂的硬件地址转换工作，因此几乎是不可能的事。IP 编址把这个复杂问题解决了。因此，<strong>在虚拟的 IP 网络上用 IP 地址进行通信给广大的计算机用户带来了很大的方便。</strong>（<strong>IP地址是虚拟网络的重要手段，屏蔽了不同网络之间的硬件地址差异）</strong>   </li>
</ol>
</li>
</ol>
<p><img src="https://imageurlbed.oss-cn-shenzhen.aliyuncs.com/img/ARPmessaging.png" alt=""></p>
<p><img src="https://imageurlbed.oss-cn-shenzhen.aliyuncs.com/img/ARP4types.png" alt=""></p>
<h4 id="IP数据报的格式"><a href="#IP数据报的格式" class="headerlink" title="IP数据报的格式"></a>IP数据报的格式</h4><ol>
<li><p>由<strong>首部和数据部分</strong>组成。首部<strong>固定</strong>长度为<strong>20字节</strong>，此外还可加入长度可变的<strong>可选字段</strong>，总长度必须是<strong>4字节的倍数</strong>，最大为<strong>60字节</strong>。数据报总长度最大不能超过数据链路层协议规定的<strong>最大传送单元MTU，即1500字节</strong>，否则需要进行<strong>分片处理</strong>。<br><img src="https://imageurlbed.oss-cn-shenzhen.aliyuncs.com/img/ipdatamessage.png" alt="IP数据报">  </p>
</li>
<li><p><strong>首部固定字段</strong>：</p>
<ol>
<li><p><strong>版本</strong>——<strong>占 4 位</strong>，指 <strong>IP 协议的版本</strong>。目前的 IP 协议版本号为 <strong>4，即IPv4</strong>。</p>
</li>
<li><p><strong>首部长度</strong>——<strong>占 4 位</strong>，可表示的最大数值是 <strong>15</strong>（单位为4字节），这里15表示<strong>15个32位字长，也就是15个4字节</strong>，因此 IP 的首部长度的最大值是 <strong>60 字节（也就是15）</strong>。（<strong>最小值为固定长度20字节（也就是5）</strong>）</p>
</li>
<li><p><strong>区分服务</strong>——<strong>占 8 位</strong>，用来获得更好的服务。只有在使用区分服务DS（Differentiated Services）时，这个字段才起作用。在一般的情况下都<strong>不使用</strong>这个字段 。</p>
</li>
<li><p><strong>总长度——占 16 位</strong>，<strong>指首部和数据之和的长度</strong>，单位为<strong>字节</strong>，因此数据报的理论最大长度为 <strong>65535 字节</strong>。但实际上，总长度必须不超过最大传送单元 MTU，否则需要<strong>分片</strong>。例如，<strong>以太网的MTU规定为1500字节</strong>。</p>
</li>
<li><p><strong>标识identification</strong> ——<strong>占 16 位</strong>，它是一个计数器，每产生一个数据报就加一，用来产生 <strong>IP 数据报的标识</strong>。作用是：分片时，为各数据报片设定一个标识，<strong>相同标识的数据报片最终可被重新拼接起来</strong>。</p>
</li>
<li><p><strong>标志flag</strong> ——<strong>占 3 位</strong>，目前只有低两位有意义。同样是为了分片。</p>
<ol>
<li>标志字段的最低位是 <strong>MF（More Fragment）</strong>。<strong>MF=1 表示后面“还有分片”。MF=0 表示最后一个分片。</strong></li>
<li>标志字段中间的一位是 <strong>DF（ Don′t Fragment）</strong> 。只有当 <strong>DF=0 时才允许分片。</strong></li>
</ol>
</li>
<li><p><strong>片偏移——占13 位</strong>，指出：<strong>较长的分组在分片后某片在原分组中的相对位置</strong>。片偏移以 <strong>8 个字节</strong>为偏移单位，除最后一个数据报片外，所有数据报片的长度都是<strong>8字节的倍数</strong>。</p>
<ol>
<li>各片可以继承原IP数据报的首部，但必须更改以下字段：</li>
<li>修改各数据报片的<strong>总长度字段。</strong><ol>
<li>修改各数据报片的<strong>标识字段。</strong></li>
<li>修改各数据报片的<strong>片偏移字段。</strong></li>
<li>修改各数据报片的<strong>标志字段。</strong></li>
</ol>
</li>
</ol>
<p><img src="https://imageurlbed.oss-cn-shenzhen.aliyuncs.com/img/fragmentpianyi.png" alt="分片"></p>
</li>
</ol>
</li>
</ol>
<pre><code>     ![分片结果](C:\Users\jsj31\AppData\Roaming\Typora\typora-user-images\image-20231117133837173.png)



  8. **生存时间——占8 位**，记为 **TTL Time To Live**，指示数据报在网络中**可通过的路由器数**的最大值，单位为**跳hop**。

  9. **协议——占8 位**，指出此数据报携带的数据**使用何种协议（TCP/UDP）**，以便目的主机的 IP 层将数据部分上交给那个处理过程。

  10. **首部检验和——占16 位**，为了减少工作量，**只检验数据报的首部，不检验数据部分**。这里**不采用 CRC **检验码而采用简单的计算方法

     1. 方法：IP 数据报首部检验和的计算采用 **16 位二进制反码求和算法**，如果反码加数据报首部**为0**则正确。
   11. 过程：在发送方将IP数据报的首部**划分为许多16位的字序列**；并把检验和字段置零，用**反码运算术将字相加**之后，将得到的和的**反码**写入检验和位置；在接受方接收到数据报之后，使用相同的方法将首部所有的字（包括检验和）相加一次，若没有出错则得到的结果**必然为零**，最后的结果便可作为是否出错的判断标志；

       3. **反码运算**：在普通的二进制加法的基础上，最高位如果产生进位，需要将最后的结果加1。

  12. **源IP地址和目的IP地址都各占 4 字节，32位，表示主机ip地址。**
</code></pre><ol>
<li><strong>首部可变字段</strong>：IP 首部的可变部分就是一个选项字段，用来支持<strong>排错、测量以及安全</strong>等措施，内容很丰富。1到40字节。</li>
</ol>
<h3 id="IP层转发分组的过程"><a href="#IP层转发分组的过程" class="headerlink" title="IP层转发分组的过程"></a>IP层转发分组的过程</h3><h4 id="基于终点的转发"><a href="#基于终点的转发" class="headerlink" title="基于终点的转发"></a>基于终点的转发</h4><ol>
<li><p>分组在互联网中是<strong>基于终点的转发</strong>，但是路由器中的转发表却不是按目的IP地址来直接查出下一跳路由器的。</p>
</li>
<li><p>每一台主机都有一个<strong>路由表</strong>。按主机所在的网络地址来制作路由表.</p>
</li>
<li><p>在路由表中，对每一条路由，最主要的是<strong>（目的网络地址，下一跳地址）</strong>。具体如何选择路径需要依据<strong>路由选择协议</strong>，如内部网关协议<strong>RIP或OSPF。</strong></p>
</li>
<li><p>根据目的网络地址就能确定下一跳路由器，这样做的结果是：</p>
<ol>
<li><p>IP 数据报最终一定可以找到<strong>目的主机所在目的网络上的路由器</strong>（可能要通过多次的间接交付）。</p>
</li>
<li><p>只有到达最后一个路由器时，才试图向目的主机进行<strong>直接交付</strong>。</p>
</li>
</ol>
</li>
</ol>
<p><img src="https://imageurlbed.oss-cn-shenzhen.aliyuncs.com/img/routerluyou.png" alt="路由转发"></p>
<h4 id="最长前缀匹配"><a href="#最长前缀匹配" class="headerlink" title="最长前缀匹配"></a>最长前缀匹配</h4><ol>
<li>使用CIDR时，路由表中的每个项目由“网络前缀”和“下一跳地址”组成，在查找路由表是可能会得到不止一个匹配结果。从匹配结果中选择最长的网络前缀的路由就是<strong>最长前缀匹配（long-prefix matching）</strong>，网络前缀越长，其地址块就越小，因而路由就越具体（more specific）。</li>
</ol>
<p><img src="https://imageurlbed.oss-cn-shenzhen.aliyuncs.com/img/LPM1.png" alt=""></p>
<p><img src="https://imageurlbed.oss-cn-shenzhen.aliyuncs.com/img/LPM2.png" alt=""></p>
<p><img src="https://imageurlbed.oss-cn-shenzhen.aliyuncs.com/img/LPM3.png" alt=""></p>
<ol>
<li><p><strong>主机路由（host route）又叫特定主机路由</strong>：虽然互联网所有的分组转发都是基于目的主机所在的网络，但在大多数情况下都允许有这样的特例，<strong>即为特定的目的主机指明一个路由</strong>。采用特定主机路由可使网络管理人员能更方便地控制网络和测试网络，同时也可在需要考虑某种安全问题时采用这种特定主机路由。比如这个特定主机路由的点分十进制IP地址是a.b.c.d，则其在转发表中对应于主机路由的网络前缀为a.b.c.d/32。</p>
</li>
<li><p><strong>默认路由</strong>：路由器还可采用默认路由以<strong>减少路由表所占用的空间和搜索路由表所用的时间。</strong>前缀为<strong>0.0.0.0/0</strong>，如果掩码原码and为0，就交给指定的默认路由器R进行处理（间接交付）。 </p>
</li>
</ol>
<p><img src="https://imageurlbed.oss-cn-shenzhen.aliyuncs.com/img/defaultroute.png" alt="默认路由"></p>
<ol>
<li><p>每一次转发分组时，<strong>IP数据报中的IP源、目的地址不变，变的只是MAC地址</strong>。路由器的网络接口软件使用 ARP 负责将下一跳路由器的 IP 地址转换成硬件地址，并将此硬件地址放在链路层的 MAC 帧的首部，然后根据这个硬件地址找到下一跳路由器。</p>
</li>
<li><p><strong>路由器分组转发算法</strong>：</p>
<ol>
<li><p>从数据报的首部提取目的主机的 IP 地址 D, 根据<strong>子网掩码</strong>得出目的网络地址为 N。</p>
</li>
<li><p>若网络 N 与此路由器<strong>直接相连</strong>，则把数据报直接交付目的主机 D；否则是间接交付，执行3。</p>
</li>
<li><p>若路由表中有<strong>目的地址为 D 的特定主机路由</strong>，则把数据报传送给路由表中所指明的下一跳路由器；否则，执行4。</p>
</li>
<li><p>若路由表中有<strong>到达网络 N 的路由</strong>，则把数据报传送给路由表指明的下一跳路由器；否则，执行5。</p>
</li>
<li><p>若路由表中有一个<strong>默认路由</strong>，则把数据报传送给路由表中所指明的默认路由器；否则，执行6。</p>
</li>
<li><p>报告转发分组出错。</p>
</li>
</ol>
</li>
<li><p>路由表的作用：<strong>指出到某个网络应当先到某个路由器（即下一跳路由器）。</strong>它没有给分组指明到某个网络的完整路径，而是指引分组<strong>一步步</strong>进行查找和转发，直到到达目的网络。</p>
</li>
</ol>
<h4 id="二叉线索查找路由表"><a href="#二叉线索查找路由表" class="headerlink" title="二叉线索查找路由表"></a>二叉线索查找路由表</h4><p><img src="https://imageurlbed.oss-cn-shenzhen.aliyuncs.com/img/erchaxiansuoshuchazhao.png" alt=""></p>
<h3 id="网际控制报文协议ICMP"><a href="#网际控制报文协议ICMP" class="headerlink" title="网际控制报文协议ICMP"></a>网际控制报文协议ICMP</h3><ol>
<li><p><strong>ICMP协议：网际控制报文协议Internet Control Message Protocol</strong>，ICMP<strong>允许主机或路由器报告差错情况和提供有关异常情况的报告</strong>。从而更有效地转发IP数据报和提高交付成功的机会。</p>
</li>
<li><p>ICMP报文装在IP数据报中，作为其中的<strong>数据部分</strong>。</p>
<p><img src="https://imageurlbed.oss-cn-shenzhen.aliyuncs.com/img/ICMPmessage.png" alt="ICMP报文"></p>
</li>
<li><p><strong>ICMP差错报告报文</strong></p>
<ol>
<li><p><strong>终点不可达</strong></p>
</li>
<li><p><strong>时间超过</strong></p>
</li>
<li><p><strong>参数问题</strong></p>
</li>
<li><p><strong>改变路由</strong>（重定向）Redirect（存在更好的路径）</p>
</li>
</ol>
</li>
<li><p>ICMP差错报告报文将IP数据报的<strong>首部和数据字段的前8个字节</strong>提取出来，作为ICMP的数据字段，再加上相应的<strong>ICMP的前8个字节</strong>组成了ICMP差错报告报文。</p>
</li>
</ol>
<p><img src="https://imageurlbed.oss-cn-shenzhen.aliyuncs.com/img/ICMPandIP.png" alt=""></p>
<ol>
<li><p><strong>不发送ICMP差错报告报文</strong></p>
<ol>
<li>对于ICMP差错报告报文</li>
<li>对第一个分片的数据报片的所有后续数据报片</li>
<li>具有多播地址的数据报</li>
<li>具有特殊地址的数据报（127.0.0.0或0.0.0.0）</li>
</ol>
</li>
<li><p><strong>ICMP 询问报文</strong>：</p>
<ol>
<li><p><strong>回送请求或回送回答</strong>（PING命令）</p>
</li>
<li><p><strong>时间戳请求或时间戳回答</strong></p>
</li>
</ol>
</li>
<li><p>ICMP举例，使用<strong>PING</strong>来测试<strong>两个主机之间的连通性</strong>。PING使用了ICMP<strong>回送请求与回送回答报文</strong>，是应用层直接使用网络层PING的例子，<strong>没有通过运输层的TCP或UDP</strong>。</p>
</li>
</ol>
<h3 id="IPv6"><a href="#IPv6" class="headerlink" title="IPv6"></a>IPv6</h3><ol>
<li><strong>网际协议IP是互联网的核心协议</strong>。</li>
<li>互联网经过几十年的飞速发展，<strong>到 2011 年 2 月，IPv4 的 32 位地址已经耗尽。</strong></li>
<li>解决 IP 地址耗尽的根本措施就是<strong>采用具有更大地址空间的新版本的 IP，即 IPv6。</strong></li>
<li>支持<strong>无连接的传送</strong>，将协议数据单元PDU称为<strong>分组</strong>。</li>
<li><p>所引进的主要变化：</p>
<ol>
<li><strong>更大的地址空间。IPv6 将地址从 IPv4 的 32 位 增大到了 128 位。</strong></li>
<li><strong>扩展的地址层次结构。</strong></li>
<li><strong>灵活的首部格式</strong>。 IPv6 定义了许多可选的扩展首部。</li>
<li><strong>改进的选项</strong>。 IPv6 允许数据报包含有选项的控制信息，其选项放在有效载荷中。</li>
<li><strong>允许协议继续扩充</strong>。</li>
<li><strong>支持即插即用（即自动配置）</strong>。因此 IPv6 不需要使用 DHCP。</li>
<li><strong>支持资源的预分配</strong>。 IPv6 支持实时视像等要求，保证一定的带宽和时延的应用。</li>
<li><strong>IPv6 首部改为 8 字节对齐</strong>。首部长度必须是 8 字节的整数倍。原来的 IPv4 首部是 4 字节对齐。</li>
</ol>
</li>
<li><p>IPv6数据报由两大部分组成：<strong>基本首部（base header）和有效载荷（payload）</strong>，有效载荷分为零个或多个扩展首部，首部后是数据部分。</p>
</li>
</ol>
<p><img src="https://imageurlbed.oss-cn-shenzhen.aliyuncs.com/img/IPv6111.png" alt=""></p>
<ol>
<li>IPv6基本首部</li>
</ol>
<p><img src="https://imageurlbed.oss-cn-shenzhen.aliyuncs.com/img/IPv6baseheader.png" alt=""></p>
<ol>
<li><strong>IPv6数据报</strong><ol>
<li><strong>通信量类</strong>：和IPv4区分服务字段的作用相似。</li>
<li><strong>流标号</strong>：<strong>流</strong>代表了互联网络上从<strong>特定源点到特定终点（单或多播）的一系列数据报，而在这个流上所经过的路径上的路由器都保证指明的服务质量</strong>。对于音频/视频传输很有用，对于邮件等置为0。</li>
</ol>
</li>
</ol>
<p><img src="https://imageurlbed.oss-cn-shenzhen.aliyuncs.com/img/IPv6message.png" alt=""></p>
<ol>
<li><p>IPv6的目的地址基本类型地址，<strong>单播，多播和任播</strong>，任播的终点是一组计算机，但是数据报只交付其中一个，通常按照路由算法得出的距离最近的一个。</p>
</li>
<li><p>由于IPv6改为了128位，所以并没有采用和IPv4相同的点分十进制表示法，而是采用<strong>冒号十六进制记法</strong>，其中一串连续的0可以通过两个冒号替代，如<strong>FF05:B3::</strong>，一个IPv6地址只能使用一次<strong>零压缩</strong>。</p>
</li>
<li><p>IPv6地址分类</p>
</li>
</ol>
<p><img src="https://imageurlbed.oss-cn-shenzhen.aliyuncs.com/img/IPv6address.png" alt=""></p>
<ol>
<li>IPv4向IPv6过渡<ol>
<li><strong>双协议栈</strong>：一部分主机或路由器同时装有IPv4和IPv6.</li>
<li><strong>隧道技术</strong>：把IPv6数据报封装成为IPv4数据报，当IPv4数据报离开IPv4网络中的隧道时，再把数据部分（原来的IPv6数据报）交给主机的IPv6协议栈。</li>
</ol>
</li>
<li><strong>ICMPv6</strong>，IPv6和IPv4一样不保证数据包的可靠交付，所以使用ICMP来反馈一些差错信息，称为ICMPv6.</li>
</ol>
<h3 id="互联网的路由选择协议"><a href="#互联网的路由选择协议" class="headerlink" title="互联网的路由选择协议"></a>互联网的路由选择协议</h3><h4 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h4><ol>
<li><p>路由route：<strong>为分组找路径。</strong></p>
</li>
<li><p>理想的路由算法：</p>
<ol>
<li>算法必须是正确的和完整的：一定可以找到目的网络和主机。</li>
<li>算法在计算上应简单。</li>
<li>算法应能适应通信量和网络拓扑的变化，这就是说，要有自适应性。</li>
<li>算法应具有稳定性。</li>
<li>算法应是公平的。</li>
<li>算法应是最佳的。</li>
</ol>
</li>
<li><p>按照路由选择算法是否能<strong>随着网络的通信量或者拓扑自适应地进行调整变化</strong>来划分：</p>
<ol>
<li><strong>静态路由选择策略</strong>——即<strong>非自适应路由选择</strong>，其特点是<strong>简单和开销较小</strong>，但<strong>不能及时适应网络状态的变化。</strong></li>
<li><strong>动态路由选择策略</strong>——即<strong>自适应路由选择</strong>，其特点是<strong>能较好地适应网络状态的变化，但实现起来较为复杂，开销也比较大。</strong></li>
</ol>
</li>
<li><p>互联网采用<strong>自适应的（动态）、分层次的</strong>路由选择协议。</p>
<ol>
<li>互联网的规模非常大。如果让所有的路由器知道所有的网络应怎样到达，则这种路由表将非常大，处理起来也太花时间。而所有这些路由器之间交换路由信息所需的带宽就会使互联网的通信链路饱和。</li>
<li>许多单位不愿意外界了解自己单位网络的布局细节和本部门所采用的路由选择协议（这属于本部门内部的事情），但同时还希望连接到互联网上。</li>
</ol>
</li>
<li><p><strong>自治系统AS Autonomous System </strong>：<strong>在单一的技术管理下的一组路由器</strong>，路由选择协议划分为内部和外部网关协议。（自治系统相连采用的是<strong>网关Gateway）</strong></p>
</li>
</ol>
<p>   <img src="https://hillzhang1999.gitee.io/2020/05/22/ji-suan-ji-wang-luo-quan-bu-fu-xi-bi-ji/%E8%87%AA%E6%B2%BB%E7%B3%BB%E7%BB%9F.png" alt="AS"></p>
<ol>
<li><p><strong>内部网关协议 IGP</strong> Interior Gateway Protocol（自治系统内部）</p>
<ol>
<li>在一个<strong>自治系统内部</strong>使用的路由选择协议。</li>
<li>目前这类路由选择协议使用得最多，如 <strong>RIP 和 OSPF 协议。</strong></li>
</ol>
</li>
<li><p><strong>外部网关协议 EGP</strong> External Gateway Protocol（自治系统之间）</p>
<ol>
<li>若源站和目的站<strong>处在不同的自治系统</strong>中，当数据报传到一个自治系统的边界时，就需要使用一种协议将路由选择信息传递到另一个自治系统中。这样的协议就是外部网关协议 EGP。</li>
<li>在外部网关协议中目前使用最多的是 <strong>BGP-4</strong>。</li>
</ol>
</li>
</ol>
<h4 id="内部网关协议-RIP"><a href="#内部网关协议-RIP" class="headerlink" title="内部网关协议 RIP"></a>内部网关协议 <strong>RIP</strong></h4><ol>
<li><strong>路由信息协议 RIP</strong> Routing Information Protocol是内部网关协议 IGP 中<strong>最先</strong>得到广泛使用的协议。</li>
<li>RIP 是一种<strong>分布式的、基于距离向量的</strong>路由选择协议。</li>
<li>RIP 协议要求网络中的每一个路由器都要维护<strong>从它自己到其他每一个目的网络的距离记录</strong>。</li>
<li>RIP中的距离也称为<strong>“跳数”hop count</strong>，<strong>因为每经过一个路由器，跳数就加 1。直接相连的路由器跳数为1。</strong></li>
<li>RIP 认为一个好的路由就是<strong>它通过的路由器的数目少，即“距离短”</strong>。（但其实不一定，<strong>有的路径可能速度更快但路由数较多</strong>）</li>
<li>RIP 允许一条路径最多只能包含 <strong>15 个</strong>路由器。“距离”的最大值为 16 时即相当<strong>于不可达</strong>。可见 RIP 只适用于<strong>小型互联网</strong>。</li>
<li><p>RIP协议的特点：</p>
<ol>
<li>仅和<strong>相邻路由器</strong>交换信息。</li>
<li>交换的信息是当前本路由器所知道的全部信息，即<strong>自己的路由表</strong>。</li>
<li>按<strong>固定的时间间隔</strong>交换路由信息，例如，每隔 30 秒。当网络拓扑发生变化时，路由器也及时向相邻路由器通告拓扑变化后的路由信息。</li>
</ol>
</li>
<li>路由器在刚刚开始工作时，只知道<strong>到直接连接的网络的距离（此距离定义为 1）</strong>。它的路由表是空的。经过若干次<strong>交换信息和更新</strong>后，所有的路由器最终都会知道到达本自治系统中任何一个网络的最短距离和下一跳路由器的地址。<strong>这个若干次更新的过程即为RIP的收敛</strong>。</li>
<li>RIP协议的路由器之间交换信息的方式是：<strong>RIP报文</strong>。它使用运输层的<strong>用户数据报协议UDP</strong>进行传送。</li>
<li>RIP协议的更新路由表算法：<strong>距离向量算法(Bellman-ford, SPFA)</strong>，人话为先找到源点，然后每次算出一个源点到相邻点的距离（比如A不到C但A到B，第一次只能找到A到B距离，第二次就可以找到A到B再到C的距离），如果距离变短就更新，无更新就退出收敛。</li>
</ol>
<p><img src="https://imageurlbed.oss-cn-shenzhen.aliyuncs.com/img/julixiangliangsuanfa.png" alt=""></p>
<p><img src="https://imageurlbed.oss-cn-shenzhen.aliyuncs.com/img/Bellman1.png" alt=""></p>
<p><img src="https://imageurlbed.oss-cn-shenzhen.aliyuncs.com/img/Bellman2.png" alt=""></p>
<ol>
<li><p>RIP 协议特点：<strong>好消息传播得快，坏消息传播得慢。</strong>当网络出现故障时，要经过比较长的时间 例如数分钟例如数分钟 才能将此信息传送到所有的路由器。（<strong>故障的链路对路由表的修改在还未发送出去时，可能被收到的相邻路由器尚未更新的路由表信息覆盖掉</strong>）</p>
</li>
<li><p>优点：<strong>实现简单，开销较小。</strong></p>
</li>
<li><p>缺点：</p>
<ol>
<li>RIP <strong>限制了网络的规模</strong>，它能使用的最大距离为 15（16 表示不可达）。</li>
<li>路由器之间交换的路由信息是<strong>路由器中的完整路由表</strong>，因而随着网络规模的扩大，<strong>开销也就增加。</strong></li>
<li>“坏消息传播得慢”，使<strong>更新过程的收敛时间过长</strong>。</li>
</ol>
</li>
<li><p>Net2更新是因为下一跳为R4，Net3更新是因为比较了大小。</p>
</li>
</ol>
<p><img src="https://imageurlbed.oss-cn-shenzhen.aliyuncs.com/img/RIPexample.png" alt="距离向量算法"></p>
<h4 id="内部网关协议-OSPF（开放最短路径优先协议）"><a href="#内部网关协议-OSPF（开放最短路径优先协议）" class="headerlink" title="内部网关协议 OSPF（开放最短路径优先协议）"></a>内部网关协议 OSPF（<strong>开放最短路径优先协议</strong>）</h4><ol>
<li><strong>开放最短路径优先 OSPF Open Shortest Path First</strong>是一种<strong>链路状态协议</strong>。<ol>
<li>“开放”表明 OSPF 协议不是受某一家厂商控制，而是<strong>公开发表</strong>的。</li>
<li>“最短路径优先”是因为使用了 <strong>Dijkstra 提出的动态规划的最短路径算法 SPF</strong>。注意：OSPF 只是一个协议的名字，它并不表示其他的路由选择协议不是“最短路径优先”。</li>
<li>采用<strong>分布式</strong>的链路状态协议 link state protocol。</li>
</ol>
</li>
<li><p>三大要点：</p>
<ol>
<li>向本自治系统中所有路由器发送信息，这里使用的方法是<strong>洪泛法</strong>。路由器通过所有的端口向所有的相邻路由器发送信息，而所有的相邻路由器也是同样的做法，（但发送的对象不包括之前向他发送信息的那个路由器），从而最终<strong>使得整个局域网都得到该信息的一个副本。</strong></li>
<li>发送的信息就是<strong>与本路由器相邻的所有路由器的链路状态</strong>，但这只是路由器所知道的部分信息。（Dijkstra算法只需要相邻链路状态即可获取最短路径）</li>
<li>只有<strong>当链路状态发生变化</strong>时，路由器才用洪泛法向所有路由器发送此信息。</li>
</ol>
</li>
<li>由于各路由器之间频繁地交换链路状态信息，因此所有的路由器最终都能建立一个<strong>链路状态数据库</strong>。这个数据库实际上就是全网的拓扑结构图，它在全网范围内是<strong>一致</strong>的（<strong>这称为链路状态数据库的同步</strong>）。OSPF 的链路状态数据库能<strong>较快地进行更新</strong>，使各个路由器能及时更新其路由表。</li>
<li><p>优点：</p>
<ol>
<li>OSPF 的更新过程<strong>收敛得快</strong>；</li>
<li>OSPF 没有“<strong>坏消息传播得慢</strong>”的问题</li>
<li><p>OSPF 能够用于<strong>规模很大</strong>的网络，采用<strong>划分区域</strong>的方式。</p>
<ol>
<li>划分区域的好处就是<strong>将利用洪泛法交换链路状态信息的范围局限于每一个区域而不是整个的自治系统</strong>，这就减少了整个网络上的通信量。</li>
<li>在一个区域内部的路由器<strong>只知道本区域的完整网络拓扑</strong>，而不知道其他区域的网络拓扑的情况。</li>
</ol>
</li>
</ol>
</li>
</ol>
<p><img src="https://imageurlbed.oss-cn-shenzhen.aliyuncs.com/img/splitarea.png" alt=""></p>
<ol>
<li>OSPF 不用 UDP 而是直接用 <strong>IP 数据报</strong>传送。（<strong>RIP使用UDP</strong>）</li>
</ol>
<p><img src="https://imageurlbed.oss-cn-shenzhen.aliyuncs.com/img/OSPFclassify.png" alt="OSPF分组"></p>
<ol>
<li>OPSF和RIP比较</li>
</ol>
<p><img src="https://imageurlbed.oss-cn-shenzhen.aliyuncs.com/img/LSDVcompare.png" alt=""></p>
<p><img src="https://imageurlbed.oss-cn-shenzhen.aliyuncs.com/img/Bellmandij.png" alt=""></p>
<h4 id="外部网关协议BGP"><a href="#外部网关协议BGP" class="headerlink" title="外部网关协议BGP"></a>外部网关协议BGP</h4><ol>
<li>BGP采用了<strong>路径向量（path vector）路由选择协议</strong>，与距离向量协议RIP和链路状态协议OSPF有很大区别。</li>
</ol>
<h4 id="路由器"><a href="#路由器" class="headerlink" title="路由器"></a>路由器</h4><ol>
<li>路由器是一种典型的<strong>网络层设备</strong>。<strong>作用是连通不同的网络（局域网），进行分组转发</strong>。</li>
<li>路由器是互联网的核心部分中的关键设备。</li>
<li><p>路由器的主要作用是：</p>
<ol>
<li><strong>连通不同的网络。</strong></li>
<li><strong>选择信息传送的线路（路由选择协议）</strong>。选择通畅快捷的近路，能大大提高通信速度，减轻网络系统通信负荷，节约网络系统资源，提高网络系统畅通率，从而让网络系统发挥出更大的效益来。</li>
</ol>
</li>
</ol>
<p><img src="https://imageurlbed.oss-cn-shenzhen.aliyuncs.com/img/routestructure.png" alt="路由器"></p>
<ol>
<li><p>“转发”和“路由选择”的区别 :</p>
<ol>
<li><p>“转发”forwarding就是路由器根据转发表将用户的 IP 数据报<strong>从合适的端口</strong>转发出去。</p>
</li>
<li><p>“路由选择”routing则是按照<strong>分布式算法</strong>，根据从各相邻路由器得到的关于网络拓扑的变化情况，<strong>动态地改变所选择的路由</strong>。</p>
</li>
<li><p><strong>路由表是根据路由选择算法得出的。而转发表是从路由表得出的。</strong></p>
</li>
</ol>
</li>
</ol>
<h3 id="IP多播"><a href="#IP多播" class="headerlink" title="IP多播"></a>IP多播</h3><ol>
<li>采用<strong>反向路径广播RPB</strong>策略。</li>
<li>过程<ol>
<li>路由器收到多播数据报时，先检查是否从源点经最短路径来的。</li>
<li>如果是，就向所有其他方向转发刚才收到的多播数据报（除了进入的方向），否则丢弃。</li>
<li>如果存在几条长度相等的，只选择一条最短路径，准则是看谁的相邻路由器的<strong>IP地址最小</strong>。</li>
</ol>
</li>
</ol>
<h2 id="课后习题"><a href="#课后习题" class="headerlink" title="课后习题"></a>课后习题</h2><ul>
<li><strong>一个3200位长的TCP报文传到IP层，加上160位的首部后成为数据报。下面的互联网由两个局域网通过路由器连接起来。但第二个局域网所能传送的最长数据帧中的数据部分只有1200位。因此数据报在路由器必须进行分片。试问第二个局域网向其上层要传送多少比特的数据（这里的“数据”当然指的是局域网看见的数据）?</strong></li>
</ul>
<blockquote>
<p>IP数据报的最大长度为1200位，1200=160+1040，所以3200位的TCP报文可以分成1024+1024+1024+128，每一个部分分别加上160位首部，总共长度为3840bit。</p>
</blockquote>
<ul>
<li><strong>设某路由器建立了如下路由表： <br>前缀匹配————————————下一跳 <br>192.4.153.0/26————————-R3<br>128.96.39.0/25————————接口m0 <br>128.96.39.128/25——————-接口m1 <br>128.96.40.0/25————————-R2 <br>192.4.153.0/26————————-R3<br>（默认）————————————-R4  <br>现共收到5个分组，其目的地址分别为： <br>（1）128.96.39.10 <br>（2）128.96.40.12 <br>（3）128.96.40.151 <br>（4）192.4.153.17 <br>（5）192.4.153.90 <br>试分别计算下一跳。</strong></li>
</ul>
<blockquote>
<ol>
<li>与第二行子网掩码按位与匹配，接口为m0。</li>
<li>与第四行子网掩码按位与匹配，接下一条为R2。</li>
<li>与所有都不匹配，默认R4。</li>
<li>与第一行匹配，R3。</li>
<li>都不匹配，默认R4。</li>
</ol>
</blockquote>
<ul>
<li><strong>一个数据报长度为4000字节（固定首部长度）。现在经过一个网络传送，但此网络能够传送的最大数据长度为1500字节。试问应当划分为几个短些的数据报片？各数据报片的数据字段长度、片偏移字段和MF标志应为何数值？</strong></li>
</ul>
<blockquote>
<p>固定首部长度为20字节，因此数据报数据长度为3980字节。划分为3个子数据报，偏移字段单位为8个字节，MF为0表示后面没有分片。</p>
</blockquote>
<div class="table-container">
<table>
<thead>
<tr>
<th>数据字段长度</th>
<th>片偏移字段</th>
<th>MF标志</th>
</tr>
</thead>
<tbody>
<tr>
<td>1480</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>1480</td>
<td>185</td>
<td>1</td>
</tr>
<tr>
<td>1480</td>
<td>370</td>
<td>0</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li><strong>已知路由器R1的转发表如下表所示。试画出各网络和必要的路由器的连接拓扑，标注出必要的IP地址和接口，对不能确定的情况应当指明。</strong></li>
</ul>
<p><img src="https://imageurlbed.oss-cn-shenzhen.aliyuncs.com/img/networkc424.png" alt=""></p>
<blockquote>
<p><img src="https://imageurlbed.oss-cn-shenzhen.aliyuncs.com/img/networkc24a.jpg" alt=""></p>
</blockquote>
<ul>
<li><strong>一个大公司有一个总部和三个下属部门。公司分配到的网络前缀是192.77.33/24。总部共有5个局域网,其中的LAN1到LAN4都连接到路由器R1上,R1再通过LAN5与路由器R2相连。R2和远地的三个部门的局域网LAN6到LAN8通过广域网WAN1到WAN3相连。主机数分别为50，10，28，10，20，20，25。试给出每一个局域网分配一个合适的网络前缀。</strong></li>
</ul>
<blockquote>
<p>主机数分别需要6，4，5，4，5，5，5个，而LAN5用剩下的即可。</p>
<p>LAN1:  192.77.33.0/26</p>
<p>LAN3: 192.77.33.64/27</p>
<p>LAN6: 192.77.33.96/27</p>
<p>LAN7: 192.77.33.128/27</p>
<p>LAN8: 192.77.33.160/27</p>
<p>LAN2: 192.77.33.192/28</p>
<p>LAN4: 192.77.33.208/28</p>
<p>LAN5: 192.77.33.224/29 预留几个主机位</p>
<p>WAN1: 192.77.33.232/30</p>
<p>WAN2: 192.77.33.236/30</p>
<p>WAN3: 192.77.33.240/30</p>
</blockquote>
<ul>
<li><strong>某单位分配到一个地址块136.23.12.64/26。现在需要进一步划分为4个一样大的子网。试问:<br>(1）每一个子网的网络前缀有多长？<br>(2）每一个子网中有多少个地址？<br>(3）每一个子网的地址是什么？<br>(4）每一个子网可分配给主机使用的最小地址和最大地址是什么？</strong></li>
</ul>
<blockquote>
<ol>
<li>28位（26位右移2位即可）</li>
<li>$2^4$=16个地址</li>
<li>136.23.12.64/28, 136.23.12.80/28. 136.23.12.86/28, 136.23.12.112/28</li>
<li>136.23.12.65/28      136.23.12.78/28<br>136.23.12.81/28      136.23.12.94/28<br>136.23.12.97/28      136.23.12.110/28<br>136.23.12.113/28   136.23.12.126/28</li>
</ol>
</blockquote>
<ul>
<li><strong>试简述RIP，OSPF和BGP路由选择协议得主要特点。</strong></li>
</ul>
<blockquote>
<ol>
<li>RIP：分布式基于距离向量，仅和相邻路由器交换信息，固定时间交换信息。</li>
<li>OSPF：链路状态协议，开放最短路径优先，通过所有端口向自治系统中的所有路由器发送信息，当链路状态变化或者一段时间后向所有路由器发送链路状态信息。</li>
<li>BGP：不同自治系统路由器之间的交换路由信息协议。在不同自治系统见交换可达性信息，只能找到一条较好路由。</li>
</ol>
</blockquote>
<ul>
<li><strong>假定网络中得路由器B的路由表有如下项目。</strong></li>
</ul>
<p><img src="https://imageurlbed.oss-cn-shenzhen.aliyuncs.com/img/c4371.png" alt=""></p>
<p>​                <strong>现在B收到从C发来的路由信息如下表，试求出路由器B更新后的路由表</strong></p>
<p><img src="https://imageurlbed.oss-cn-shenzhen.aliyuncs.com/img/c4372.png" alt=""></p>
<blockquote>
<p>N2：距离变为5，因为下一跳时C</p>
<p>N3：距离变为9，本来没有，下一跳为C</p>
<p>N6：距离变为5，因为C更短，下一跳为C</p>
<p>N8：不变，因为一样长</p>
<p>N9：不变，因为一样长</p>
</blockquote>
<ul>
<li><p><strong>如图所示，网络145.13.0.0/16划分为四个子网N1，N2，N3，N4。四个子网与路由器R连接的接口分别是m0，m1，m2，m3。路由器R的第五个接口m4连接到互联网。</strong></p>
<p><strong>(1)试给出路由器R的路由表。</strong></p>
<p><strong>(2)路由器R收到一个分组，其目的地址是145.13.160.78。试给出这个分组是怎样被转发的。</strong></p>
</li>
</ul>
<p><img src="https://imageurlbed.oss-cn-shenzhen.aliyuncs.com/img/c448.jpg" alt=""></p>
<blockquote>
<ol>
<li><p>| 网络前缀      | 下一跳     | 网络接口 |<br>| ——————- | ————— | ———— |<br>| 145.13/18     | 直接交付   | m0       |<br>| 145.13.64/18  | 直接交付   | m1       |<br>| 145.13.128/18 | 直接交付   | m2       |<br>| 145.13.192/18 | 直接交付   | m3       |<br>| 0.0.0.0/0     | 默认路由器 | m4       |</p>
</li>
<li><p>先与子网掩码按位与得145.13.128.0/18，与一个子网网络前缀匹配，通过m3端口发出。</p>
</li>
</ol>
</blockquote>
<ul>
<li><p><strong>已知一具有4个接口的路由器R1的转发表如表所示，转发表的每一行给出了目的地址的范围，以及对应的转发接口。</strong></p>
<p>| 目的地址范围                                 | 转发接口 |<br>| —————————————————————— | ———— |<br>| 最小地址 11100000 00000001 00000000 00000000 | 0        |<br>| 最大地址 11100000 00000001 11111111 11111111 |          |<br>| 最小地址 11100000 00000000 00000000 00000000 | 1        |<br>| 最大地址 11100000 00000000 11111111 11111111 |          |<br>| 最小地址 11100000 00000010 00000000 00000000 | 2        |<br>| 最大地址 11100001 11111111 11111111 11111111 |          |<br>| 其他                                         | 3        |</p>
<p><strong>(1)试把以上转发表改换成另一形式，其中的目的地址范围改成前缀匹配，而转发表由4行增加为5行。<br>(2)若路由器收到一个分组，其目的地址是：<br>(a)11100000 10000001 01010001 01010101<br>(b)11100000 00000000 11010111 01111100<br>( c)11100001 10010000 00010001 01110111<br>试给出每一种情况分组转发的应当通过的接口。</strong></p>
</li>
</ul>
<blockquote>
<ol>
<li><p>| 网络前缀     | 转发接口 |<br>| —————— | ———— |<br>| 224.1.0.0/16 | 1        |<br>| 224.0.0.0/15 | 0        |<br>| 224.0.0.0/7  | 2        |<br>| 224.0.0.0/5  | 3        |<br>| 0.0.0.0/0    | 3        |</p>
</li>
<li><p>接口2，接口1，接口3</p>
</li>
</ol>
</blockquote>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://example.com">Jerry Jiang</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2023/11/09/%E8%AE%A1%E7%BD%91%E7%AC%AC%E5%9B%9B%E7%AB%A0/">http://example.com/2023/11/09/%E8%AE%A1%E7%BD%91%E7%AC%AC%E5%9B%9B%E7%AB%A0/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">Jerryの魔法小屋</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://imageurlbed.oss-cn-shenzhen.aliyuncs.com/img/mountains-7750722_1920.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/11/10/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%80%E7%AB%A0/" title="操作系统第一章"><img class="cover" src="https://imageurlbed.oss-cn-shenzhen.aliyuncs.com/img/mountains-7750722_1920.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">操作系统第一章</div></div></a></div><div class="next-post pull-right"><a href="/2023/11/09/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%B9%9D%E7%AB%A0/" title="计网第九章"><img class="cover" src="https://imageurlbed.oss-cn-shenzhen.aliyuncs.com/img/mountains-7750722_1920.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">计网第九章</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://imageurlbed.oss-cn-shenzhen.aliyuncs.com/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Jerry Jiang</div><div class="author-info__description">赞美太阳！</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">15</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/etherea1ity"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/etherea1ity" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:jsj31415926@outlook.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来到我的小屋！</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E7%AB%A0-%E7%BD%91%E7%BB%9C%E5%B1%82"><span class="toc-number">1.</span> <span class="toc-text">第四章 网络层</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%87%8D%E8%A6%81%E5%86%85%E5%AE%B9"><span class="toc-number">1.1.</span> <span class="toc-text">重要内容</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E7%9F%A5%E8%AF%86%E7%82%B9"><span class="toc-number">1.2.</span> <span class="toc-text">核心知识点</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E5%B1%82%E5%87%A0%E4%B8%AA%E6%A6%82%E5%BF%B5"><span class="toc-number">1.2.1.</span> <span class="toc-text">网络层几个概念</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E5%B1%82%E6%8F%90%E4%BE%9B%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.2.1.1.</span> <span class="toc-text">网络层提供的两种服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E5%B1%82%E7%9A%84%E4%B8%A4%E4%B8%AA%E5%B1%82%E9%9D%A2"><span class="toc-number">1.2.1.2.</span> <span class="toc-text">网络层的两个层面</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E9%99%85IP"><span class="toc-number">1.2.2.</span> <span class="toc-text">网际IP</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%99%9A%E6%8B%9F%E4%BA%92%E8%81%94%E7%BD%91%E7%BB%9C"><span class="toc-number">1.2.2.1.</span> <span class="toc-text">虚拟互联网络</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#IP%E5%9C%B0%E5%9D%80"><span class="toc-number">1.2.2.2.</span> <span class="toc-text">IP地址</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%86%E7%B1%BB%E7%9A%84IP%E5%9C%B0%E5%9D%80"><span class="toc-number">1.2.2.2.1.</span> <span class="toc-text">分类的IP地址</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%92%E5%88%86%E5%AD%90%E7%BD%91%E5%92%8C%E6%9E%84%E9%80%A0%E8%B6%85%E7%BD%91"><span class="toc-number">1.2.2.2.2.</span> <span class="toc-text">划分子网和构造超网</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%97%A0%E5%88%86%E7%B1%BB%E7%BC%96%E5%88%B6CIDR"><span class="toc-number">1.2.2.2.3.</span> <span class="toc-text">无分类编制CIDR</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#IP%E5%9C%B0%E5%9D%80%E7%89%B9%E7%82%B9"><span class="toc-number">1.2.2.2.4.</span> <span class="toc-text">IP地址特点</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#IP%E5%9C%B0%E5%9D%80%E4%B8%8EMAC%E5%9C%B0%E5%9D%80"><span class="toc-number">1.2.2.3.</span> <span class="toc-text">IP地址与MAC地址</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%B0%E5%9D%80%E8%A7%A3%E6%9E%90%E5%8D%8F%E8%AE%AEARP"><span class="toc-number">1.2.2.4.</span> <span class="toc-text">地址解析协议ARP</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#IP%E6%95%B0%E6%8D%AE%E6%8A%A5%E7%9A%84%E6%A0%BC%E5%BC%8F"><span class="toc-number">1.2.2.5.</span> <span class="toc-text">IP数据报的格式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IP%E5%B1%82%E8%BD%AC%E5%8F%91%E5%88%86%E7%BB%84%E7%9A%84%E8%BF%87%E7%A8%8B"><span class="toc-number">1.2.3.</span> <span class="toc-text">IP层转发分组的过程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E7%BB%88%E7%82%B9%E7%9A%84%E8%BD%AC%E5%8F%91"><span class="toc-number">1.2.3.1.</span> <span class="toc-text">基于终点的转发</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%80%E9%95%BF%E5%89%8D%E7%BC%80%E5%8C%B9%E9%85%8D"><span class="toc-number">1.2.3.2.</span> <span class="toc-text">最长前缀匹配</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8C%E5%8F%89%E7%BA%BF%E7%B4%A2%E6%9F%A5%E6%89%BE%E8%B7%AF%E7%94%B1%E8%A1%A8"><span class="toc-number">1.2.3.3.</span> <span class="toc-text">二叉线索查找路由表</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E9%99%85%E6%8E%A7%E5%88%B6%E6%8A%A5%E6%96%87%E5%8D%8F%E8%AE%AEICMP"><span class="toc-number">1.2.4.</span> <span class="toc-text">网际控制报文协议ICMP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IPv6"><span class="toc-number">1.2.5.</span> <span class="toc-text">IPv6</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%92%E8%81%94%E7%BD%91%E7%9A%84%E8%B7%AF%E7%94%B1%E9%80%89%E6%8B%A9%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.2.6.</span> <span class="toc-text">互联网的路由选择协议</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-number">1.2.6.1.</span> <span class="toc-text">基本概念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%85%E9%83%A8%E7%BD%91%E5%85%B3%E5%8D%8F%E8%AE%AE-RIP"><span class="toc-number">1.2.6.2.</span> <span class="toc-text">内部网关协议 RIP</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%85%E9%83%A8%E7%BD%91%E5%85%B3%E5%8D%8F%E8%AE%AE-OSPF%EF%BC%88%E5%BC%80%E6%94%BE%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%BE%84%E4%BC%98%E5%85%88%E5%8D%8F%E8%AE%AE%EF%BC%89"><span class="toc-number">1.2.6.3.</span> <span class="toc-text">内部网关协议 OSPF（开放最短路径优先协议）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%96%E9%83%A8%E7%BD%91%E5%85%B3%E5%8D%8F%E8%AE%AEBGP"><span class="toc-number">1.2.6.4.</span> <span class="toc-text">外部网关协议BGP</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E5%99%A8"><span class="toc-number">1.2.6.5.</span> <span class="toc-text">路由器</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IP%E5%A4%9A%E6%92%AD"><span class="toc-number">1.2.7.</span> <span class="toc-text">IP多播</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%BE%E5%90%8E%E4%B9%A0%E9%A2%98"><span class="toc-number">1.3.</span> <span class="toc-text">课后习题</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/11/10/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%80%E7%AB%A0/" title="操作系统第一章"><img src="https://imageurlbed.oss-cn-shenzhen.aliyuncs.com/img/mountains-7750722_1920.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="操作系统第一章"/></a><div class="content"><a class="title" href="/2023/11/10/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%80%E7%AB%A0/" title="操作系统第一章">操作系统第一章</a><time datetime="2023-11-10T06:07:21.000Z" title="发表于 2023-11-10 14:07:21">2023-11-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/11/09/%E8%AE%A1%E7%BD%91%E7%AC%AC%E5%9B%9B%E7%AB%A0/" title="计网第四章"><img src="https://imageurlbed.oss-cn-shenzhen.aliyuncs.com/img/mountains-7750722_1920.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="计网第四章"/></a><div class="content"><a class="title" href="/2023/11/09/%E8%AE%A1%E7%BD%91%E7%AC%AC%E5%9B%9B%E7%AB%A0/" title="计网第四章">计网第四章</a><time datetime="2023-11-09T12:05:34.000Z" title="发表于 2023-11-09 20:05:34">2023-11-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/11/09/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%B9%9D%E7%AB%A0/" title="计网第九章"><img src="https://imageurlbed.oss-cn-shenzhen.aliyuncs.com/img/mountains-7750722_1920.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="计网第九章"/></a><div class="content"><a class="title" href="/2023/11/09/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%B9%9D%E7%AB%A0/" title="计网第九章">计网第九章</a><time datetime="2023-11-09T06:00:38.000Z" title="发表于 2023-11-09 14:00:38">2023-11-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/10/30/commonlit/" title="commonlit competition review"><img src="https://imageurlbed.oss-cn-shenzhen.aliyuncs.com/img/commonlit.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="commonlit competition review"/></a><div class="content"><a class="title" href="/2023/10/30/commonlit/" title="commonlit competition review">commonlit competition review</a><time datetime="2023-10-30T13:53:55.000Z" title="发表于 2023-10-30 21:53:55">2023-10-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/10/30/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA%E7%AC%AC%E4%B8%80%E7%AB%A0/" title="第一章绪论"><img src="https://imageurlbed.oss-cn-shenzhen.aliyuncs.com/img/DATABASECARTOON.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="第一章绪论"/></a><div class="content"><a class="title" href="/2023/10/30/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA%E7%AC%AC%E4%B8%80%E7%AB%A0/" title="第一章绪论">第一章绪论</a><time datetime="2023-10-30T10:33:39.000Z" title="发表于 2023-10-30 18:33:39">2023-10-30</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By Jerry Jiang</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, '']
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typesetPromise()
}</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>